from random import shuffle

import numpy as np
import pytest

CAFFEINE_XTB = """24

C          1.07317        0.04885       -0.07573
N          2.51365        0.01256       -0.07580
C          3.35199        1.09592       -0.07533
N          4.61898        0.73028       -0.07549
C          4.57907       -0.63144       -0.07531
C          3.30131       -1.10256       -0.07524
C          2.98068       -2.48687       -0.07377
O          1.82530       -2.90038       -0.07577
N          4.11440       -3.30433       -0.06936
C          5.45174       -2.85618       -0.07235
O          6.38934       -3.65965       -0.07232
N          5.66240       -1.47682       -0.07487
C          7.00947       -0.93648       -0.07524
C          3.92063       -4.74093       -0.06158
H          0.73398        1.08786       -0.07503
H          0.71239       -0.45698        0.82335
H          0.71240       -0.45580       -0.97549
H          2.99301        2.11762       -0.07478
H          7.76531       -1.72634       -0.07591
H          7.14864       -0.32182        0.81969
H          7.14802       -0.32076       -0.96953
H          2.86501       -5.02316       -0.05833
H          4.40233       -5.15920        0.82837
H          4.40017       -5.16929       -0.94780
"""

CAFFEINE_XTB_CMA = """24

C          -2.913221    1.617013    -0.003496
N          -1.472741    1.580723    -0.003566
C          -0.634401    2.664083    -0.003096
N          0.632589    2.298443    -0.003256
C          0.592679    0.936723    -0.003076
C          -0.685081    0.465603    -0.003006
C          -1.005711    -0.918707    -0.001536
O          -2.161091    -1.332217    -0.003536
N          0.128009    -1.736167    0.002874
C          1.465349    -1.288017    -0.000116
O          2.402949    -2.091487    -0.000086
N          1.676009    0.091343    -0.002636
C          3.023079    0.631683    -0.003006
C          -0.065761    -3.172767    0.010654
H          -3.252411    2.656023    -0.002796
H          -3.274001    1.111183    0.895584
H          -3.273991    1.112363    -0.903256
H          -0.993381    3.685783    -0.002546
H          3.778919    -0.158177    -0.003676
H          3.162249    1.246343    0.891924
H          3.161629    1.247403    -0.897296
H          -1.121381    -3.454997    0.013904
H          0.415939    -3.591037    0.900604
H          0.413779    -3.601127    -0.875566
"""

CAFFEINE_XTB_ROTATED = """24

C      0.000000    0.000000    0.000000
N      0.000000   -0.000000    1.440937
C      0.027298    1.103793    2.251727
N      0.018994    0.770281    3.527523
C     -0.015495   -0.591576    3.521921
C     -0.028175   -1.094567    2.256431
C     -0.064687   -2.486034    1.970767
O     -0.073776   -2.928423    0.826168
N     -0.089014   -3.274320    3.124715
C     -0.073958   -2.792858    4.450344
O     -0.093669   -3.572210    5.407882
N     -0.036585   -1.409132    4.626198
C     -0.021822   -0.835227    5.959233
C     -0.133076   -4.714691    2.967187
H      0.025262    1.029828   -0.365250
H     -0.911742   -0.491950   -0.347970
H      0.886557   -0.536074   -0.347902
H      0.052263    2.115820    1.867129
H     -0.040596   -1.605572    6.734725
H     -0.900910   -0.194914    6.082835
H      0.887769   -0.238932    6.082275
H     -0.144049   -5.023239    1.919009
H     -1.032993   -5.098154    3.459225
H      0.742359   -5.153025    3.457406
"""

CAFFEINE_GFF = """24
 energy: -4.677663123621 gnorm: 0.000418935769 xtb: 6.7.1 (edcfbbe)
C            1.03241232922086        0.01083492539353       -0.07522816093971
N            2.48797627580391        0.05521706099833       -0.07567226328938
C            3.33431554304134        1.14153542407614       -0.07747791435768
N            4.59970558840287        0.77725604559334       -0.07716221859181
C            4.60653475574364       -0.57039268896632       -0.07513446192146
C            3.30785975406879       -1.05283386338902       -0.07431556571352
C            3.01432284259922       -2.46579656793642       -0.07106837295742
O            1.87087581697316       -2.89097386219637       -0.07086985080755
N            4.13384453817139       -3.30798256362319       -0.06793184818515
C            5.46199982524775       -2.84706801241789       -0.06997637253642
O            6.39245969945558       -3.63691882441198       -0.06884753160654
N            5.69730213921532       -1.47218380644944       -0.07351264702586
C            7.05049583737426       -0.97309733569549       -0.07499375560023
C            3.91473907908114       -4.73024085747678       -0.06368859239119
H            0.61829785032832        1.01637728481974       -0.07529491503021
H            0.68762546539156       -0.52335464994504        0.80764416082963
H            0.68708645347587       -0.52367025834217       -0.95769729766940
H            3.00642492926634        2.17083184586623       -0.07841315009329
H            7.74422522108608       -1.81292737956622       -0.07538919054533
H            7.21907769134003       -0.36633018226540        0.81227952108394
H            7.21737239971474       -0.36687267261407       -0.96296150551748
H            2.84470235231249       -4.93518803059926       -0.06261425893998
H            4.37229252831109       -5.16349914679079        0.82381122642931
H            4.37144108437426       -5.16862188406143       -0.94910503462330
"""

CAFFEINE_GFF_ALIGNED = """24

C      1.032406     0.010824    -0.075228
N      2.487970     0.055211    -0.075673
C      3.334305     1.141533    -0.077479
N      4.599697     0.777258    -0.077163
C      4.606531    -0.570390    -0.075135
C      3.307858    -1.052836    -0.074316
C      3.014326    -2.465800    -0.071068
O      1.870881    -2.890982    -0.070869
N      4.133851    -3.307982    -0.067931
C      5.462005    -2.847062    -0.069976
O      6.392467    -3.636910    -0.068847
N      5.697302    -1.472177    -0.073513
C      7.050494    -0.973086    -0.074994
C      3.914751    -4.730241    -0.063688
H      0.618288     1.016365    -0.075295
H      0.687622    -0.523367     0.807644
H      0.687082    -0.523683    -0.957697
H      3.006411     2.170828    -0.078414
H      7.744226    -1.812913    -0.075390
H      7.219073    -0.366318     0.812279
H      7.217368    -0.366861    -0.962962
H      2.844715    -4.935192    -0.062613
H      4.372306    -5.163497     0.823812
H      4.371454    -5.168621    -0.949104
"""

CAFFEINE_OBABEL = """24

C      0.8386861685    2.3213832518    0.0010145738
N      1.0653014660    0.8729242511   -0.0000214594
C      2.3184263459    0.3223786159   -0.0008480483
N      1.6274263583   -0.5517078054   -0.0022388503
C      0.7215992891   -1.2013751523   -0.0019368855
C      0.0362179478   -0.0158207422    0.0003381297
C     -1.4349785264    0.0369662984    0.0033774333
O     -2.0569094114    1.0837423228    0.0062761005
N     -2.0392433349   -1.1889082038    0.0038185877
C     -1.3887949619   -2.3933182627    0.0004337555
O     -2.0022408409   -3.4463203653    0.0006547338
N     -0.0244704068   -2.3686449774   -0.0021002133
C      0.7646931543   -3.6133446731   -0.0036790374
C     -3.5211821920   -1.2424968568    0.0094433313
H      1.7927742350    2.8549060126    0.0032623100
H      0.2677844604    2.5994076569    0.8913082227
H      0.2711447399    2.6009557963   -0.8909346942
H      3.2197333040    0.9168049818    0.0008472191
H      0.1266508985   -4.5003129988   -0.0062220724
H      1.3971083521   -3.6365855905    0.8877087428
H      1.3994336185   -3.6333386595   -0.8933820058
H     -3.9752819067   -0.2490883471    0.0122296564
H     -3.8576064983   -1.7785508485    0.9010397951
H     -3.8648098649   -1.7768842904   -0.8804701717
"""

CAFFEINE_OBABEL_HEAVY_ALIGNED = """24

C      1.164154     0.125946    -0.076439
N      2.630020     0.100935    -0.075525
C      3.387209     1.241149    -0.075206
N      4.129921     0.410553    -0.075707
C      4.614710    -0.593225    -0.074880
C      3.329222    -1.065254    -0.074374
C      3.025042    -2.505630    -0.071913
O      1.887153    -2.938935    -0.070583
N      4.129200    -3.311073    -0.070098
C      5.427279    -2.876691    -0.071702
O      6.359549    -3.661548    -0.070333
N      5.636825    -1.528328    -0.073794
C      6.998371    -0.964191    -0.073492
C      3.927977    -4.780266    -0.064918
H      0.802059     1.157362    -0.074550
H      0.791203    -0.388959     0.813297
H      0.792628    -0.385169    -0.968945
H      2.956066     2.231004    -0.073966
H      7.762852    -1.744821    -0.075110
H      7.128479    -0.345226     0.818145
H      7.128051    -0.342164    -0.962948
H      2.871433    -5.057371    -0.063572
H      4.397245    -5.203701     0.827254
H      4.396742    -5.210298    -0.954260
"""

CAFFEINE_OBABEL_CMA = """24

C     1.185292    3.070851    -0.000649
N     1.411907    1.622392    -0.001685
C     2.665032    1.071846    -0.002511
N     1.974032    0.197760    -0.003902
C     1.068205    -0.451907    -0.003600
C     0.382824    0.733647    -0.001325
C     -1.088373    0.786434    0.001714
O     -1.710304    1.833210    0.004613
N     -1.692638    -0.439440    0.002155
C     -1.042189    -1.643850    -0.001230
O     -1.655635    -2.696853    -0.001009
N     0.322135    -1.619177    -0.003764
C     1.111299    -2.863877    -0.005342
C     -3.174576    -0.493029    0.007780
H     2.139380    3.604374    0.001599
H     0.614390    3.348876    0.889645
H     0.617750    3.350424    -0.892598
H     3.566339    1.666273    -0.000816
H     0.473257    -3.750845    -0.007885
H     1.743714    -2.887118    0.886045
H     1.746039    -2.883871    -0.895045
H     -3.628676    0.500380    0.010566
H     -3.511001    -1.029083    0.899376
H     -3.518204    -1.027416    -0.882133
"""

# FIXME: Check with crest whether this is the correct structure
CAFFEINE_OBABEL_ALIGNED = """24

C      1.154606     0.109937    -0.076297
N      2.620590     0.093227    -0.075995
C      3.371311     1.237709    -0.076716
N      4.118713     0.411331    -0.077013
C      4.609179    -0.589685    -0.075762
C      3.326384    -1.068984    -0.074410
C      3.030366    -2.511057    -0.070913
O      1.894949    -2.950797    -0.068823
N      4.139067    -3.310234    -0.069063
C      5.434664    -2.868512    -0.071495
O      6.371364    -3.648077    -0.070031
N      5.636572    -1.518986    -0.074525
C      6.994902    -0.947149    -0.075159
C      3.946168    -4.780540    -0.062873
H      0.786678     1.139288    -0.074902
H      0.784954    -0.406510     0.813921
H      0.785602    -0.403837    -0.968323
H      2.934571     2.225108    -0.075914
H      7.763790    -1.723438    -0.076614
H      7.121882    -0.326894     0.816032
H      7.120681    -0.324959    -0.965062
H      2.891210    -5.063621    -0.060902
H      4.418204    -5.200748     0.829363
H      4.416983    -5.208472    -0.952145
"""

CONFORMER_ALANINEGLYCINE = """ 20
         -3.29043274
 C         -1.6321181436       -0.4950412169       -0.4388175255
 C         -1.0601192704        0.7861921159        0.1352022236
 N          0.1686759469        1.2697272451       -0.2705389450
 C          1.1630975251        0.5057857660       -1.0151553133
 C          2.0695254192       -0.2510417746       -0.0884659156
 O          1.7126206528       -1.3122084104        0.3681987469
 N         -1.1710072194       -1.6259686083        0.3535906389
 O         -1.7094865517        1.3596725936        0.9868776265
 O          3.2551450258        0.3197570585        0.2050044990
 H         -1.4955247859       -1.5107151044        1.3027979702
 H         -0.1499154512       -1.6026038771        0.3886086893
 C         -3.1436510805       -0.4337826841       -0.4782297869
 H         -1.2619643332       -0.6287300701       -1.4665544793
 H          0.5695436109        2.0387188758        0.2638419740
 H          1.7598407568        1.1912735302       -1.6242082481
 H          0.6791075634       -0.1853097145       -1.7064452100
 H          3.7201475705       -0.2761651918        0.8220430242
 H         -3.5300376991       -0.2452763016        0.5233005506
 H         -3.4925290819        0.3763876124       -1.1192129019
 H         -3.5689425338       -1.3720992106       -0.8345805531
  20
         -3.29029889
 C         -1.9257994844       -0.5888108146       -0.4368489195
 C         -1.0374191079        0.5997018661       -0.1445450199
 N          0.0848344464        0.7532474434       -0.9409065134
 C          1.3161342544        1.1782910468       -0.3118278560
 C          2.1261971621       -0.0283561625        0.0795917235
 O          1.6052746055       -1.1202616469        0.1287106867
 N         -1.3473172147       -1.7407805770        0.2523548818
 O         -1.2676836463        1.3014116798        0.8192322815
 O          3.4262516921        0.1819606603        0.3691390622
 H         -1.5537385838       -1.6648824018        1.2382914894
 H         -0.3289150008       -1.6552609836        0.1840525889
 C         -3.3579464265       -0.3295824849       -0.0293485313
 H         -1.8830012265       -0.7978525600       -1.5179623245
 H          0.2734688624        0.0410884328       -1.6477603927
 H          1.0617528674        1.7639427566        0.5768225091
 H          1.8848900195        1.8218208962       -0.9889529033
 H          3.8143230763       -0.6807398283        0.6089409113
 H         -3.3998491779       -0.0629688854        1.0265126172
 H         -3.7859975571        0.5010301014       -0.5911662888
 H         -3.9793409725       -1.2120429515       -0.1819067904
  20
         -3.28845409
 C         -2.0479790406       -0.4507402299       -0.3819947826
 C         -1.0699124757        0.6981403976       -0.2288625678
 N          0.0607513292        0.6725206680       -1.0255456734
 C          1.3177272713        1.1066396740       -0.4545249221
 C          2.0242347227       -0.0579187764        0.1869732033
 O          1.4648449930       -1.1251425633        0.3034381756
 N         -1.2911352280       -1.6556356904       -0.7398806454
 O         -1.2614077326        1.5580160864        0.6077798518
 O          3.2840588827        0.1625092905        0.6141653104
 H         -1.7316307922       -2.4976171375       -0.3963653432
 H         -0.3502065791       -1.5796689920       -0.3317808949
 C         -2.8416922310       -0.6343706205        0.8930893972
 H         -2.7259440126       -0.2185777956       -1.2185930064
 H          0.1894311986       -0.1152000447       -1.6706054532
 H          1.1026430446        1.8714322078        0.2979042928
 H          1.9466947716        1.5614431485       -1.2248241443
 H          3.6069554859       -0.6694584052        1.0093511024
 H         -2.1713921404       -0.8859749977        1.7144386508
 H         -3.3541415635        0.2890815308        1.1654321765
 H         -3.5809571249       -1.4299614158        0.8001456578
  20
         -3.28768655
 C         -1.2334358566       -0.6937209868        0.1788826891
 C         -0.9848930311        0.7927126800        0.3063217322
 N          0.2561731554        1.2896632233        0.6384622296
 C          1.4355967000        0.4779506147        0.9176864585
 C          1.9106764503       -0.2491841576       -0.3056907178
 O          1.3646121082       -1.2756976947       -0.6375788536
 N         -2.2212396219       -1.0960685572        1.1665829015
 O         -1.9320488284        1.5254138820        0.1077029589
 O          2.9323420165        0.3030727237       -0.9906636490
 H         -3.0636556114       -0.5653660589        0.9935379795
 H         -1.9084786351       -0.8417305228        2.0950783680
 C         -1.6764753331       -1.0306620505       -1.2271775876
 H         -0.3066355609       -1.2472039468        0.3916129516
 H          0.3959576504        2.2995304451        0.6293789082
 H          1.2008566180       -0.2369789079        1.7099717529
 H          2.2443484362        1.1123910890        1.2925168057
 H          3.1192928543       -0.2755873949       -1.7540974327
 H         -2.5570193227       -0.4455205606       -1.4916437200
 H         -0.8910035342       -0.8011823502       -1.9488897552
 H         -1.9290317209       -2.0873464060       -1.3161200374
"""

CAFFEINE_RMSD_TEST_DATA = [
    # Conformer1, Conformer2, heavy, rmsd, aligned_conformer, Umat
    (
        CAFFEINE_XTB,
        CAFFEINE_XTB_ROTATED,
        False,
        0.00000042,
        CAFFEINE_XTB,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [
                [0.000586, 0.025178, 0.999683],
                [0.025178, 0.999366, -0.025185],
                [-0.999683, 0.025185, -0.000049],
            ],
            dtype=np.float64,
        ),
    ),
    (
        CAFFEINE_XTB,
        CAFFEINE_OBABEL,
        False,
        0.13939435,
        CAFFEINE_OBABEL_ALIGNED,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [
                [0.165823, -0.986155, -0.000907],
                [0.986155, 0.165823, 0.000503],
                [-0.000346, -0.000978, 0.999999],
            ],
            dtype=np.float64,
        ),
    ),
    (
        CAFFEINE_XTB,
        CAFFEINE_XTB_ROTATED,
        True,
        0.00000042,
        CAFFEINE_XTB,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [
                [0.000586, 0.025178, 0.999683],
                [0.025178, 0.999366, -0.025185],
                [-0.999683, 0.025185, -0.000049],
            ],
            dtype=np.float64,
        ),
    ),
    (
        CAFFEINE_XTB,
        CAFFEINE_OBABEL,
        True,
        0.1725815540,
        CAFFEINE_OBABEL_HEAVY_ALIGNED,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [
                [0.171404, -0.9852, -0.001332],
                [0.985201, 0.171405, -0.00012],
                [0.000347, -0.001292, 0.999999],
            ],
            dtype=np.float64,
        ),
    ),
]


CAFFEINE_AXIS_TEST_DATA = [
    # Conformer1, rot constants in MHz, avmom in a.u., evec
    (
        CAFFEINE_XTB,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [1068.073127, 710.711798, 430.26121],
            dtype=np.float64,
        ),
        1.30564546e-44,
        np.asarray(
            [
                [0.671158, -0.741313, 0.001206],
                [0.741314, 0.671157, -0.001149],
                [0.000042, 0.001665, 0.999999],
            ],
            dtype=np.float64,
        ),
    ),
    (
        CAFFEINE_OBABEL,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            [1146.303928, 700.554317, 438.439373],
            dtype=np.float64,
        ),
        1.28135123e-44,
        np.asarray(
            [
                [0.657967, 0.753046, -0.000501],
                [0.753044, -0.657967, -0.002205],
                [-0.00199, 0.001073, -0.999997],
            ],
            dtype=np.float64,
        ),
    ),
]

CAFFEINE_CN_TEST_DATA = [
    # Conformer1, cn
    (
        CAFFEINE_OBABEL,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            # fmt: off
            [3.689705,3.866219,2.934731,3.626334,3.144874,3.791101,2.768159,0.858364,2.743387,
             2.716063,0.860503,2.747386,3.698299,3.698564,0.924137,0.924083,0.924084,0.925654,
             0.924202,0.92413,0.924141,0.924245,0.924105,0.924098],
            # fmt: on
            dtype=np.float64,
        ),
    ),
]

CAFFEINE_CANONICAL_TEST_DATA = [
    # Conformer1, heavy, canonical_atom_id
    (
        CAFFEINE_XTB,
        False,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            # fmt: off
                [1,8,5,7,13,14,12,6,10,9,2,11,4,3,15,15,15,18,17,17,17,16,16,16],
            # fmt: on
            dtype=int,
        ),
    ),
    (
        CAFFEINE_XTB,
        True,
        # FIXME: check with crest, this is actually taken from this code itself but the rmsd is the same as crest
        np.asarray(
            # fmt: off
                [1,8,5,7,13,14,12,6,10,9,2,11,4,3,0,0,0,0,0,0,0,0,0,0],
            # fmt: on
            dtype=int,
        ),
    ),
]

CAFFEINE_IRMSD_TEST_DATA = [
    # Conformer1, Conformer2, mask, rmsd, aligned_conformer, Umat
    (
        CAFFEINE_XTB,
        CAFFEINE_XTB,
        0.00000000,
        CAFFEINE_XTB,
    ),
    (
        CAFFEINE_XTB,
        CAFFEINE_XTB_ROTATED,
        0.00000042,
        CAFFEINE_XTB,
    ),
    (CAFFEINE_XTB, CAFFEINE_GFF, 0.06160473, CAFFEINE_GFF_ALIGNED),
]

CAFFEINE_SORTER_IRMSD_TEST_DATA = [
    # conformer list, distance threshold, groups
    (
        [
            CAFFEINE_XTB,
            CAFFEINE_XTB,
            CAFFEINE_OBABEL,
        ],
        0.125,
        np.asarray([1, 1, 2]),
    ),
    (
        [
            CAFFEINE_XTB,
            CAFFEINE_XTB_ROTATED,
            CAFFEINE_OBABEL,
            CAFFEINE_GFF,
        ],
        0.05,
        np.asarray([1, 1, 2, 3]),
    ),
    (
        [
            CAFFEINE_XTB,
            CAFFEINE_XTB_ROTATED,
            CAFFEINE_OBABEL,
            CAFFEINE_GFF,
        ],
        0.125,
        np.asarray([1, 1, 2, 1]),
    ),
]

CAFFEINE_DELTA_IRMSD_LIST_TEST_DATA = [
    (
        [CAFFEINE_XTB, CAFFEINE_XTB, CAFFEINE_GFF],
        np.asarray(
            [0.0, 0.0, 0.06160473],
            dtype=np.float64,
        ),
    ),
]


@pytest.fixture(scope="session")
def caffeine_molecule_xyz():
    """Fixture that returns a caffeine molecule."""
    return CAFFEINE_XTB


@pytest.fixture(scope="session")
def caffeine_molecule_xyz_rotated():
    """Fixture that returns a caffeine molecule."""
    return CAFFEINE_XTB_ROTATED


@pytest.fixture(scope="session")
def caffeine_molecule_xyz_obabel():
    """Fixture that returns a caffeine molecule."""
    return CAFFEINE_OBABEL


@pytest.fixture(scope="session")
def caffeine_molecule_xyz_gff():
    """Fixture that returns a caffeine molecule."""
    return CAFFEINE_GFF


@pytest.fixture(scope="session")
def alanine_glycine_conformers_xyz():
    """Fixture that returns alanine-glycine conformers."""
    return CONFORMER_ALANINEGLYCINE


@pytest.fixture(scope="session")
def caffeine_axis_test_data_all():
    """Fixture that returns all caffeine axis test data."""
    return CAFFEINE_AXIS_TEST_DATA


@pytest.fixture(scope="session")
def caffeine_cn_test_data_all():
    """Fixture that returns all caffeine cn test data."""
    return CAFFEINE_CN_TEST_DATA


@pytest.fixture(scope="session")
def caffeine_canonical_test_data_all():
    """Fixture that returns all caffeine canonical test data."""
    return CAFFEINE_CANONICAL_TEST_DATA


@pytest.fixture(scope="session")
def caffeine_irmsd_test_data_all():
    """Fixture that returns all caffeine irmsd test data."""
    return CAFFEINE_IRMSD_TEST_DATA


@pytest.fixture(scope="session")
def caffeine_rmsd_test_data_all():
    """Fixture that returns all caffeine rmsd test data."""
    return CAFFEINE_RMSD_TEST_DATA


@pytest.fixture(scope="session", params=CAFFEINE_RMSD_TEST_DATA)
def caffeine_rmsd_test_data(request):
    """Fixture that returns atom numbers and positions for caffeine molecule in
    different conformations."""
    return request.param


@pytest.fixture(
    scope="session",
    params=CAFFEINE_AXIS_TEST_DATA,
)
def caffeine_axis_test_data(request):
    return request.param


@pytest.fixture(
    scope="session",
    params=CAFFEINE_CN_TEST_DATA,
)
def caffeine_cn_test_data(request):
    return request.param


@pytest.fixture(
    scope="session",
    params=CAFFEINE_CANONICAL_TEST_DATA,
)
def caffeine_canonical_test_data(request):
    return request.param


@pytest.fixture(
    scope="session",
    params=CAFFEINE_IRMSD_TEST_DATA,
)
def caffeine_irmsd_test_data(request):
    conformer1, conformer2, expected_irmsd, expected_aligned_conformer = request.param
    conformer2_list = conformer2.splitlines()
    conformer2_header = conformer2_list[:2]
    conformer2_molecule = conformer2_list[2:]
    shuffle(conformer2_molecule)

    # conformer2_shuffled = conformer2_header + conformer2_molecule[::-1]
    conformer2_shuffled = conformer2_header + conformer2_molecule

    conformer2 = "\n".join(conformer2_shuffled)
    return conformer1, conformer2, expected_irmsd, expected_aligned_conformer


@pytest.fixture(scope="session", params=CAFFEINE_SORTER_IRMSD_TEST_DATA)
def caffeine_sorter_irmsd_test_data(request):
    return request.param


@pytest.fixture(scope="session", params=CAFFEINE_DELTA_IRMSD_LIST_TEST_DATA)
def caffeine_delta_irmsd_list_test_data(request):
    return request.param
